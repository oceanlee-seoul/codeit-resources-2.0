#!/bin/bash
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RESET='\033[0m'

echo
echo
echo "ğŸ” Checking branch protection and running linting tasks... "
echo


# ------------------- ë¸Œëœì¹˜ ê²€ì‚¬ -------------------

CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
PROTECTED_BRANCHES="^(main)$"

if [[ "$CURRENT_BRANCH" =~ $PROTECTED_BRANCHES ]]
then
    printf "\n${RED}ğŸš« [Commit Blocked] '$CURRENT_BRANCH' ë¸Œëœì¹˜ì— ì§ì ‘ ì»¤ë°‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!${RESET}\n"
    printf "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
    printf "â—ï¸ í•´ë‹¹ ë¸Œëœì¹˜ëŠ” ë³´í˜¸ëœ ë¸Œëœì¹˜ì…ë‹ˆë‹¤.\n\n"
    printf "   ë³€ê²½ ì‚¬í•­ì€ ë³„ë„ì˜ ì‘ì—… ë¸Œëœì¹˜ë¥¼ í†µí•´ ë¨¸ì§€í•´ ì£¼ì„¸ìš”.\n"
    printf "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n"
  exit 1
fi

echo
echo "âœ“ Branch protection check passed"


# ------------------- lint ê²€ì‚¬ -------------------

# npx lint-staged
pnpm lint-staged

echo
echo "âœ“ Finished linting tasks and fixing code issues"
